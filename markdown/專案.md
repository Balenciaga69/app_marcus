# 專案食譜與願望清單

## 專案目標

- 最終目標：使用現代化架構解決高併發微服務的痛點。
- 學習目標：從簡單的單體應用程式開始，逐步升級以解決常見的技術痛點。
- 個人發展：透過 TypeScript 生態系深入理解 JavaScript，實踐乾淨程式碼，並體驗 RDB 的調校與優化。
- 為即將面試的公司使用 NestJS 做準備。
- 專注於解決技術痛點而非複雜的業務邏輯。

## 核心業務功能

- 發起投票與進行投票，無需登入或會員機制。
- 投票可以取消或更動(同一個指紋的用戶)。
- 目前支援二選一投票（未來預留擴展空間，支援多選項、多選題、評分等）。
- 業務核心不會隨階段變化，專注於技術實踐。

## 技術棧

- 主要語言與框架：TypeScript 生態系 (NestJS)。
- 開發與部署：一人開發、測試、部署。

## Phase 1 (當前階段)

### 核心架構

- [x] NestJS, TypeORM, Monolithic, PostgreSQL
- [x] 設計 schema 與整合 TypeORM（Poll, PollOption, Vote）
- [x] 有共用 BaseEntity（id, created_at, updated_at 為 uuid 與自動時間戳）
- [x] Entity Relations 設定（Poll ↔ PollOption ↔ Vote）
- [x] 實作 Repository Pattern（每個 Entity 都有 Interface 與實作）
- [x] 用 .env 管理設定（ConfigModule 整合）
- [x] TypeORM synchronize 開發階段自動同步 schema

### CRUD APIs

- [x] 實作 CRUD APIs (Poll, PollOption, Vote)
  - [x] Poll：完整 CRUD（Create, Read, Update, Delete）
  - [x] PollOption：Create, Read（符合甲方需求，不提供 Update/Delete）
  - [x] Vote：完整 CRUD（Create, Read, Update, Delete，支援取消/更動投票）

### 驗證與中間件

- [x] 用 class-validator 為所有 DTO 加上驗證裝飾器
- [x] 啟用 Global ValidationPipe（讓 class-validator 生效）
- [x] 加上 LoggerService，請求鏈路中帶 requestId，方便效能追蹤
- [x] RequestIdMiddleware 註冊到所有路由
- [x] 全域 LoggingInterceptor 記錄請求與回應

### 跨域與健康檢查

- [x] 設定 CORS（跨域資源共享）
- [x] 實作 Health Check 端點

### 部署與測試

- [x] Docker 容器化（docker-compose.yml + Dockerfile）
- [x] Jest 測試環境配置（package.json 有測試腳本）
- [ ] 先別做單元測試，接下來 Phase 再做。
- [ ] 壓力測試（k6）與效能分析

### 架構限制（預期瓶頸）

- [x] 這階段沒有任何快取或分層架構，可以預期會遇到效能瓶頸
- [x] 沒有分散式追蹤或 APM
- [x] 沒有讀寫分離或資料庫優化

## Phase 1 備註

目前這樣的 Repository 實作在單體應用、簡單 CRUD 下沒問題。
但未來遇到以下情境會有瓶頸：

1. 複雜查詢（多表 join、聚合、分頁、條件組合）會讓 repository 變肥大且難維護。
2. 若要支援多資料來源（如 CQRS, Event Sourcing, NoSQL），interface 需大幅調整。
3. 若要加快查詢效能，常需引入快取層（如 Redis），這時 repository 需額外包裝。
4. 若要支援分散式架構（微服務），repository pattern 會與 service boundary 產生衝突。
5. 若要做單元測試，需小心 mock repository 的行為與資料一致性。

## Phase 2 (升級階段)

- [ ] 單元測試實作（.spec.ts 檔案）
- [ ] 實作全域 HttpExceptionFilter，讓錯誤統一格式化
- [ ] 有 Transaction 管理

## 每個階共同必修

- [ ] 壓力測試(k6)與單元測試(jest)與效能分析
- [ ] 階段結束後，建立一個 Git Tag 標記版本，並附上一個 Readme，方便回顧與展示成果。描述此版本完成的內容、壓測結果、技術重點。
---
